From 718f73c9c862995163ae39c79f1725f3357fcf91 Mon Sep 17 00:00:00 2001
From: Adriaan de Groot <groot@kde.org>
Date: Thu, 9 Sep 2021 10:57:21 +0200
Subject: [PATCH] CMake: adjust extensions to changes in Calamares core

---
 CMakeLists.txt                       | 7 +++----
 modules/mobile/MobileQmlViewStep.cpp | 8 +++-----
 2 files changed, 6 insertions(+), 9 deletions(-)

Index: calamares-extensions/CMakeLists.txt
===================================================================
--- calamares-extensions.orig/CMakeLists.txt	2021-09-25 04:32:50.116000000 +0000
+++ calamares-extensions/CMakeLists.txt	2021-09-25 04:33:58.650000000 +0000
@@ -46,12 +46,12 @@
 # consumers by loading the developer's config from a build
 # directory (which doesn't have the rest of the config
 # installed inside it).
-find_package(Calamares 3.2.26 REQUIRED NO_CMAKE_PACKAGE_REGISTRY)
+set( CALAMARES_VERSION_REQUIRED 3.2.43 )
+find_package(Calamares ${CALAMARES_VERSION_REQUIRED} NO_CMAKE_PACKAGE_REGISTRY)
 if (NOT TARGET Calamares::calamares OR NOT TARGET Calamares::calamaresui)
-    message(FATAL_ERROR "Calamares found with missing CMake targets")
+    find_package(Calamares ${CALAMARES_VERSION_REQUIRED} REQUIRED)
 endif()
 
-find_package(YAMLCPP REQUIRED)  # Needed to untangle some dependencies before Calamares 3.2.36
 
 ### CMAKE SETUP
 #
Index: calamares-extensions/modules/mobile/MobileQmlViewStep.cpp
===================================================================
--- calamares-extensions.orig/modules/mobile/MobileQmlViewStep.cpp	2021-09-25 04:32:50.116000000 +0000
+++ calamares-extensions/modules/mobile/MobileQmlViewStep.cpp	2021-09-25 04:32:50.114000000 +0000
@@ -2,16 +2,14 @@
  * SPDX-License-Identifier: GPL-3.0-or-later */
 #include "MobileQmlViewStep.h"
 
+#include "Branding.h"
 #include "GlobalStorage.h"
-
-#include "locale/LabelModel.h"
+#include "locale/TranslationsModel.h"
+#include "modulesystem/ModuleManager.h"
 #include "utils/Dirs.h"
 #include "utils/Logger.h"
 #include "utils/Variant.h"
 
-#include "Branding.h"
-#include "modulesystem/ModuleManager.h"
-
 #include <QProcess>
 
 CALAMARES_PLUGIN_FACTORY_DEFINITION( MobileQmlViewStepFactory, registerPlugin< MobileQmlViewStep >(); )
